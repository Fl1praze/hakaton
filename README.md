# üìÑ –°–µ—Ä–≤–∏—Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —á–µ–∫–æ–≤ –∏ —Å—á–µ—Ç–æ–≤

–ü—Ä–æ—Å—Ç–æ–π —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ PDF‚Äë—Ñ–∞–π–ª—É —á–µ–∫–∞/—Å—á—ë—Ç–∞ –≤—ã—Ç–∞—Å–∫–∏–≤–∞–µ—Ç –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è –∏ –æ—Ç–¥–∞—ë—Ç –∏—Ö –≤ JSON.  
–¢–µ–ª–µ–≥—Ä–∞–º‚Äë–±–æ—Ç (–Ω–∞ Go) —Ö–æ–¥–∏—Ç –≤ —ç—Ç–æ—Ç API –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ —É–¥–æ–±–Ω–æ–º –≤–∏–¥–µ.

---

## üéØ –ß—Ç–æ —É–º–µ–µ—Ç

–ò–∑ –æ–¥–Ω–æ–≥–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö PDF —Å–µ—Ä–≤–∏—Å –∏—â–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
- –ò–ù–ù –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏;
- –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥–∞–≤—Ü–∞ / –±–∞–Ω–∫–∞ / –∫–æ–º–ø–∞–Ω–∏–∏;
- –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –æ–ø–µ—Ä–∞—Ü–∏–∏;
- –∏—Ç–æ–≥–æ–≤—É—é —Å—É–º–º—É;
- –¥–æ–ø. –ø–æ–ª—è (—Ç–µ–ª–µ—Ñ–æ–Ω, email, –§–ù, –§–î, –§–ü–î –∏ —Ç.–ø.) –≤ –±–ª–æ–∫–µ `auto_extracted`.

–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º:
- PyMuPDF + Tesseract ‚Üí —Ç–µ–∫—Å—Ç –∏–∑ PDF (–≤–∫–ª—é—á–∞—è —Å–∫–∞–Ω—ã);
- ruBERT (`DeepPavlov/rubert-base-cased`) + –Ω–µ–±–æ–ª—å—à–æ–π few‚Äëshot classifier ‚Üí ¬´–ø–æ–Ω–∏–º–∞–µ—Ç¬ª, –µ—Å—Ç—å –ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è;
- –Ω–∞–±–æ—Ä –∞–∫–∫—É—Ä–∞—Ç–Ω—ã—Ö regex ‚Üí –∏—â—É—Ç —É–∂–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è;
- –µ—Å–ª–∏ ML –º–æ–¥–µ–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –≤—Å—ë —Ä–∞–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —á–∏—Å—Ç—ã—Ö regex (fallback).

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

### –í–∞—Ä–∏–∞–Ω—Ç 1. Docker

```bash
git clone https://github.com/Fl1praze/hakaton.git
cd hakaton

docker build -t pdf-api .
docker run -p 8000:8000 pdf-api
```

–í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
- —Å—Ç–∞–≤—è—Ç—Å—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ Tesseract,
- –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `download_model.py` ‚Äî –æ–Ω —Å–∫–∞—á–∏–≤–∞–µ—Ç `model.pt` —Å Google Drive –ø–æ –∑–∞—Ä–∞–Ω–µ–µ –ø—Ä–æ–ø–∏—Å–∞–Ω–Ω–æ–º—É `FILE_ID`,
- –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è `uvicorn app.main:app` –Ω–∞ –ø–æ—Ä—Ç—É `8000`.

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É:
- `http://localhost:8000/health` ‚Üí —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞,
- `http://localhost:8000/docs` ‚Üí Swagger UI —Å–æ –≤—Å–µ–º–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏.

### –í–∞—Ä–∏–∞–Ω—Ç 2. –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ Docker)

```bash
git clone https://github.com/Fl1praze/hakaton.git
cd hakaton

python -m venv .venv
.\.venv\Scripts\activate      # Windows
# –∏–ª–∏ source .venv/bin/activate  # Linux / macOS

pip install -r requirements.txt

# —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Tesseract:
# Windows: https://github.com/UB-Mannheim/tesseract/wiki
# Linux:  sudo apt-get install tesseract-ocr tesseract-ocr-rus tesseract-ocr-eng
# macOS: brew install tesseract tesseract-lang

# –æ–¥–∏–Ω —Ä–∞–∑ —Å–∫–∞—á–∞—Ç—å ML‚Äë–º–æ–¥–µ–ª—å (~678 –ú–ë)
python download_model.py

# –∑–∞–ø—É—Å—Ç–∏—Ç—å API
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

---

## üì° API

Swagger UI: `http://localhost:8000/docs`  
–ë–∞–∑–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: –≤—Å–µ–≥–¥–∞ JSON.

### `GET /`
–ö–æ—Ä–æ—Ç–∫–∏–π ping –∏ —Å–ø–∏—Å–æ–∫ –æ—Å–Ω–æ–≤–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤.

### `GET /health`
–ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Å–µ—Ä–≤–∏—Å –∂–∏–≤:

```json
{ "status": "healthy", "service": "pdf-parser-api" }
```

### `POST /api/process_pdf/`
–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ PDF‚Äë—Ñ–∞–π–ª–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `file` ‚Äî multipart/form‚Äëdata, –æ–¥–Ω–æ –ø–æ–ª–µ —Å PDF.

**–û—Ç–≤–µ—Ç (–ø—Ä–∏–º–µ—Ä):**

```json
{
  "status": "success",
  "filename": "receipt.pdf",
  "data": {
    "inn": "2310031475",
    "vendor": "–ê–û \"–¢–ê–ù–î–ï–†\"",
    "date": "27.09.2025",
    "time": "20:03",
    "total": "692.88",
    "email": "info@ofd-magnit.ru",
    "phone": "70008565939",
    "auto_extracted": {
      "–§–ù": "7380440801260572",
      "–§–î": "57713"
    }
  }
}
```

–í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ —Ñ–æ—Ä–º–∞—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –¥–ª—è FastAPI:

```json
{ "detail": "–û—à–∏–±–∫–∞: –§–∞–π–ª –Ω–µ —è–≤–ª—è–µ—Ç—Å—è PDF –¥–æ–∫—É–º–µ–Ω—Ç–æ–º" }
```

### `POST /api/process-batch/`
Batch‚Äë–æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö PDF –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `files` ‚Äî –º–∞—Å—Å–∏–≤ PDF –≤ multipart/form‚Äëdata.

**–û—Ç–≤–µ—Ç (–ø—Ä–∏–º–µ—Ä):**

```json
{
  "status": "completed",
  "total": 3,
  "successful": 2,
  "failed": 1,
  "results": [
    {
      "filename": "receipt_01.pdf",
      "status": "success",
      "data": { "...": "..." }
    },
    {
      "filename": "receipt_02.pdf",
      "status": "error",
      "error": "–§–∞–π–ª –Ω–µ —è–≤–ª—è–µ—Ç—Å—è PDF –¥–æ–∫—É–º–µ–Ω—Ç–æ–º"
    }
  ]
}
```

---

## ü§ñ Telegram‚Äë–±–æ—Ç (Go)

–ö–æ–¥ –±–æ—Ç–∞ –ª–µ–∂–∏—Ç –≤ `app/bot`. –õ–æ–≥–∏–∫–∞ –ø—Ä–æ—Å—Ç–∞—è:

1. –±–æ—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è PDF –∏–ª–∏ –≥—Ä—É–ø–ø—É —Ñ–∞–π–ª–æ–≤,
2. —Å–∫–∞—á–∏–≤–∞–µ—Ç —ç—Ç–∏ —Ñ–∞–π–ª—ã –∏–∑ Telegram,
3. –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –±–∞–π—Ç—ã –≤ API (`/api/process_pdf/` –∏–ª–∏ `/api/process-batch/`),
4. —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –≤ —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
   - –±–ª–æ–∫ ¬´–û–°–ù–û–í–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø¬ª (–ò–ù–ù, –¥–∞—Ç–∞, —Å—É–º–º–∞),
   - –±–ª–æ–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤,
   - –±–ª–æ–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö,
   - –∫—É—Å–æ—á–µ–∫ JSON, —á—Ç–æ–±—ã –≤–∏–¥–Ω–æ –±—ã–ª–æ —Ä–µ–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞.

API –∏ –±–æ—Ç —Å–≤—è–∑–∞–Ω—ã —á–µ—Ä–µ–∑ `app/bot/internal/clients/api_client.go`: —Ç–∞–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω URL (`http://localhost:8000` –∏–ª–∏ `http://api:8000` –≤ Docker‚Äë—Å–µ—Ç–∏).

---

## üß† ML‚Äë—á–∞—Å—Ç—å

### –û–±—É—á–µ–Ω–∏–µ

- –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∏–∑ `app/pdf_for_study/` —Å–∫—Ä–∏–ø—Ç–æ–º `prepare_dataset.py`, —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî `app/dataset/raw_texts.json`;
- `train_few_shot_model.py` + –Ω–æ—É—Ç–±—É–∫ `app/notebooks/training_model.ipynb` –æ–±—É—á–∞—é—Ç –Ω–µ–±–æ–ª—å—à–æ–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–≤–µ—Ä—Ö `DeepPavlov/rubert-base-cased` (20 —ç–ø–æ—Ö, ~170 –ø—Ä–∏–º–µ—Ä–æ–≤ –ø–æ—Å–ª–µ –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏);
- –≤–µ—Å–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `app/models/few_shot_classifier/model.pt` (–≤ –≥–∏—Ç–µ –Ω–µ –ª–µ–∂–∏—Ç, —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `download_model.py`).

### –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ API

- –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ `app/processor.py` –ø—ã—Ç–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å `HybridBERTExtractor` –∏–∑ `hybrid_bert_model.py`;
- –º–æ–¥–µ–ª—å —Å—á–∏—Ç–∞–µ—Ç `ml_confidence` –ø–æ —Ç–µ–∫—Å—Ç—É: –µ—Å—Ç—å –ª–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ –ò–ù–ù/—Å—É–º–º–∞/–¥–∞—Ç–∞/–ø–æ—Å—Ç–∞–≤—â–∏–∫;
- regex‚Äë—á–∞—Å—Ç—å –≤—ã—Ç–∞—Å–∫–∏–≤–∞–µ—Ç —Å–∞–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è;
- –µ—Å–ª–∏ `model.pt` –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è, `HybridBERTExtractor` –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ä–µ–∂–∏–º ¬´—Ç–æ–ª—å–∫–æ regex¬ª, –∏ —Å–µ—Ä–≤–∏—Å –≤—Å—ë —Ä–∞–≤–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.

–î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏:
- `app/notebooks/training_model.ipynb` ‚Äî –ø—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è (loss/accuracy –ø–æ —ç–ø–æ—Ö–∞–º),
- `app/notebooks/demo_pipeline.ipynb` ‚Äî –ø–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω –æ—Ç PDF –¥–æ JSON –∏ –¥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
hakaton/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ main.py                    # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ processor.py               # –æ–±—â–∏–π –ø–∞–π–ø–ª–∞–π–Ω –æ–±—Ä–∞–±–æ—Ç–∫–∏ pdf
‚îÇ   ‚îú‚îÄ‚îÄ hybrid_bert_model.py       # –≥–∏–±—Ä–∏–¥–Ω–∞—è –º–æ–¥–µ–ª—å (bert + classifier + regex)
‚îÇ   ‚îú‚îÄ‚îÄ train_few_shot_model.py    # –æ–±—É—á–µ–Ω–∏–µ few-shot –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ prepare_dataset.py         # —Å–±–æ—Ä –¥–∞—Ç–∞—Å–µ—Ç–∞ –∏–∑ pdf_for_study
‚îÇ   ‚îú‚îÄ‚îÄ dataset/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ raw_texts.json         # —Ç–µ–∫—Å—Ç—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ few_shot_classifier/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ model.pt           # –≤–µ—Å–∞ –º–æ–¥–µ–ª–∏ (—Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è, –∞ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –≥–∏—Ç–µ)
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ training_history.json
‚îÇ   ‚îú‚îÄ‚îÄ pdf_for_study/             # –ø—Ä–∏–º–µ—Ä—ã —á–µ–∫–æ–≤ –∏ —Å—á–µ—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ notebooks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ training_model.ipynb   # –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ demo_pipeline.ipynb    # –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø–∞–π–ø–ª–∞–π–Ω–∞ –∏ –±–æ—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ bot/                       # Telegram‚Äë–±–æ—Ç –Ω–∞ Go
‚îÇ       ‚îú‚îÄ‚îÄ cmd/bot/main.go
‚îÇ       ‚îî‚îÄ‚îÄ internal/...
‚îú‚îÄ‚îÄ Dockerfile                     # –æ–±—Ä–∞–∑ api + tesseract
‚îú‚îÄ‚îÄ docker-entrypoint.sh           # –ø—Ä–æ–≤–µ—Ä–∫–∞/—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ model.pt + –∑–∞–ø—É—Å–∫ uvicorn
‚îú‚îÄ‚îÄ download_model.py              # —Å–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏ —Å google drive
‚îú‚îÄ‚îÄ requirements.txt               # python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ README.md                      # —ç—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## üìå –ö—Ä–∞—Ç–∫–æ

- –µ—Å—Ç—å HTTP‚Äëendpoint –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ PDF –∏ –ø–æ–ª—É—á–µ–Ω–∏—è JSON;
- –Ω–µ—Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –ø–æ–ª—è –ø–æ–º–µ—á–∞—é—Ç—Å—è —Å–ø–µ—Ü—Å–ª–æ–≤–æ–º `UNRECOGNIZED`;
- –µ—Å—Ç—å batch‚Äë–æ–±—Ä–∞–±–æ—Ç–∫–∞;
- –µ—Å—Ç—å —Ä–∞–±–æ—á–∏–π Telegram‚Äë–±–æ—Ç –ø–æ–≤–µ—Ä—Ö —ç—Ç–æ–≥–æ API;
- –µ—Å—Ç—å –¥–≤–∞ Jupyter‚Äë–Ω–æ—É—Ç–±—É–∫–∞: –æ–±—É—á–µ–Ω–∏–µ –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø–∞–π–ø–ª–∞–π–Ω–∞;
- –µ—Å—Ç—å Docker‚Äë–æ–±—Ä–∞–∑, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å—ë –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π.

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
git clone https://github.com/Fl1praze/hakaton.git
cd hakaton
docker build -t pdf-api .
docker run -p 8000:8000 pdf-api

# –¥–∞–ª–µ–µ –æ—Ç–∫—Ä—ã—Ç—å http://localhost:8000/docs –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ª—é–±–æ–π pdf –∏–∑ app/pdf_for_study
```


